# Configuration par défaut - sera écrasée par les profils spécifiques
spring:
  application:
    name: livraigo
  profiles:
    active: dev

  ai:
    openai:
      api-key: ${AI_API_KEY:demo-key}
      chat:
        options:
          model: gpt-4o-mini

  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml
    enabled: true

  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    encoding: UTF-8
    servlet:
      content-type: text/html
    cache: false

  mvc:
    static-path-pattern: /static/**

server:
  port: 8080
  servlet:
    context-path: /livraigo

logging:
  level:
    com.livraigo: DEBUG
    org.springframework.web: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'
  file:
    name: logs/livraigo.log

jackson:
  serialization:
    fail-on-empty-beans: false
  deserialization:
    fail-on-unknown-properties: false
  date-format: yyyy-MM-dd HH:mm:ss
  time-zone: Europe/Paris

app:
  optimization:
    algorithm: NEAREST_NEIGHBOR
  ai:
    provider: openai
    api-key: ${AI_API_KEY:demo-key}
  warehouse:
    latitude: 48.8566
    longitude: 2.3522
    opening-time: 06:00
    closing-time: 22:00

---
# Configuration développement
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: jdbc:h2:mem:livraigodb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:

  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        trace: false
        web-allow-others: false

app:
  optimization:
    algorithm: NEAREST_NEIGHBOR

---
# Configuration test/qualité
spring:
  config:
    activate:
      on-profile: qa

  datasource:
    url: jdbc:postgresql://localhost:5432/livraigo-qa
    driver-class-name: org.postgresql.Driver
    username: qa-user
    password: qa-password

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true

app:
  optimization:
    algorithm: CLARKE_WRIGHT

---
# Configuration production
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:livraigo-prod}
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME:prod-user}
    password: ${DB_PASSWORD:prod-password}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        jdbc:
          batch_size: 30
        order_inserts: true
        order_updates: true

logging:
  level:
    com.livraigo: INFO
    org.springframework.web: WARN
    org.hibernate: ERROR

app:
  optimization:
    algorithm: CLARKE_WRIGHT
